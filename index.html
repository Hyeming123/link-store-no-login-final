<script type="module">
  // Firebase SDK import
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA6AJRFDj0H2W6EwGBCNiqk8FLK3K_CaGc",
    authDomain: "link-store-final.firebaseapp.com",
    projectId: "link-store-final",
    storageBucket: "link-store-final.firebasestorage.app",
    messagingSenderId: "215371737635",
    appId: "1:215371737635:web:8a80e3401fa9881c29df96",
    measurementId: "G-TD1K7XG1PZ"
  };

  // Firebase 초기화
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Firestore 연동 함수
  async function loadSavedUrls() {
    const querySnapshot = await getDocs(collection(db, "urls"));
    const list = document.getElementById('urlList');
    list.innerHTML = '';
    let index = 0;
    querySnapshot.forEach((docSnap) => {
      addUrlToList(docSnap.data().url, index, docSnap.id);
      index++;
    });
  }

  async function addLink() {
    const input = document.getElementById('urlInput');
    const newUrl = input.value.trim();
    if (!newUrl) return alert('URL을 입력해주세요.');

    await addDoc(collection(db, "urls"), { url: newUrl });
    input.value = '';
    await loadSavedUrls();
  }

  async function deleteSelectedLinks() {
    const list = document.getElementById('urlList');
    const checkboxes = list.querySelectorAll('input[type="checkbox"]:checked');
    if (checkboxes.length === 0) return alert('삭제할 URL을 선택해주세요.');

    for (const cb of checkboxes) {
      const docId = cb.dataset.docid;
      await deleteDoc(doc(db, "urls", docId));
    }
    await loadSavedUrls();
  }

  function clearAllLinks() {
    if (!confirm('모든 URL을 삭제하시겠습니까?')) return;
    const list = document.getElementById('urlList');
    list.innerHTML = '';
  }

  // 리스트 아이템 생성
  function addUrlToList(url, index, docId) {
    const list = document.getElementById('urlList');
    const listItem = document.createElement('li');
    listItem.className = 'list-group-item d-flex align-items-center';

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.className = 'mr-2';
    checkbox.dataset.docid = docId;

    const link = document.createElement('a');
    link.href = url;
    link.target = '_blank';
    link.textContent = `${index + 1}번: ${url}`;

    listItem.appendChild(checkbox);
    listItem.appendChild(link);
    list.appendChild(listItem);
  }

  // 페이지 로드시 불러오기
  document.addEventListener('DOMContentLoaded', loadSavedUrls);
</script>
